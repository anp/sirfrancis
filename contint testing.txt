remotes {
    main_server {
        host = '192.241.204.245'
        user = 'francis'
        identity = new File('C:\\Users\\adamn_000\\Dropbox\\Projects\\Bacon\\technical\\francis_openssh.ppk')
        passphrase = 'no one will know'
    }
}

task deploy(dependsOn: ['clean', 'shadowJar']) {
    ssh.run {
        session(remotes.main_server) {
            def localJar = 'sirfrancis-' + version + '-all.jar'
            put 'build\\libs\\' + localJar, '/opt/bacon/'
            put 'bacon-server.yml', '/opt/bacon/'
            put 'static/', '/opt/bacon/'
            //TODO prevent error if service not running or files not present
            execute 'sudo stop sirfrancis'
            execute 'rm /opt/bacon/sirfrancis-current.jar'
            execute 'rm /opt/bacon/bacon.yml'
            execute 'mv /opt/bacon/bacon-server.yml /opt/bacon/bacon.yml'
            execute 'mv /opt/bacon/' + localJar + ' /opt/bacon/sirfrancis-current.jar'
            execute 'sudo start sirfrancis'
        }
    }
}